<?php if (!defined('THINK_PATH')) exit(); /*a:3:{s:58:"/www/wwwroot/hnqt.0898yzzx.com/tpl/client/card/submit.html";i:1653886834;s:58:"/www/wwwroot/hnqt.0898yzzx.com/tpl/client/common/meta.html";i:1650433150;s:60:"/www/wwwroot/hnqt.0898yzzx.com/tpl/client/common/script.html";i:1649383380;}*/ ?>
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta charset="utf-8">
<title>圈圈食堂</title>
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">

<link rel="stylesheet" href="/static/client/mui/css/clear.css">
<link rel="stylesheet" href="/static/client/mui/css/mui.min.css">
<link rel="stylesheet" href="/static/client/mui/css/common.css">
<link rel="stylesheet" href="/static/client/css/jquery-loadprompt.css">
<!-- <style type="text/css">
	#box{
		position: fixed;
		top: 0;
		height: 100vh;
		line-height: 100vh;
		width: 100%;
		background-color: rgba(0,0,0,1);
		color: white;
		text-align: center;
		z-index: 99999;
	}
</style>
<div id="box">外卖系统将于4月20日对外开放</div> -->
		<link rel="stylesheet" href="/static/client/css/page-orders-submit.css">
		<style>
			* {
				margin: 0;
				padding: 0;
			}

			.as {
				display: flex;
				flex-wrap: wrap;
				padding: 20px;
			}

			.as li {
				width: 30%;
				padding: 10px;
				background: orangered;
				display: flex;
				flex-flow: column;
				align-items: center;
				border-radius: 5px;
				color: white;
				margin: 5px;
				box-shadow: 0px 5px 10px 0px rgba(0, 0, 0, .5);
			}

			.as li img {
				width: 100%;
			}

			.box {
				position: fixed;
				top: 0;
				left: 0;
				height: 100vh;
				background: gold;
			}
		</style>
	</head>
	<style type="text/css">
		.visiHidden,
		.visiHidden1 {
			display: none
		}
	</style>
	<body>
		<div class="mui-content">
			<div class="orders-submit-panel">
			<div class="box">
				<h3 style="text-align: center;padding-top: 18px;">每月享6个会员红包</h3>
				<p style="text-align: center;font-size: 13px;color: gray;">无门槛、不限任何门店</p>
				<ul class="as">
					<li><span>￥5</span><span>无门槛</span></li>
					<li><span>￥5</span><span>无门槛</span></li>
					<li><span>￥5</span><span>无门槛</span></li>
					<li><span>￥5</span><span>无门槛</span></li>
					<li><span>￥5</span><span>无门槛</span></li>
					<li><span>￥5</span><span>无门槛</span></li>
				</ul>
				<p style="text-align: center;font-size: 13px;color: gray;margin-top: 50px;">放心开通,不自动续费</p>
				<div
					style="width: 95%;padding: 20px;border-radius: 5px;margin: 20px auto;background: linear-gradient(to right,orangered,gold);display: flex;align-items: center;justify-content: space-between;box-shadow: 0px 5px 10px 0px rgba(0,0,0,.5);position: absolute;bottom: 0;left: 50%;transform: translate(-50%);">
					<div>
						<p style="color: white;font-size: 20px;"><span style="color: gold;">15元</span>开通月卡</p>
						<p style="color: white;margin: 15px 0;">领取<span
								style="font-size: 20px;color: gold;">5元X6张</span>通用优惠劵</p>
						<button onclick="buyCard()"
							style="font-size: 16px;background: gold;color: red;height: 50px;width: 200px;border: 0;">点击开通</button>
					</div>
					<img src="/static/img/card.png" alt="" width="25%">
				</div>
			</div>
			</div>
		</div>
	</body>
	<script src="/static/jquery/jquery-2.1.4.min.js" charset="utf-8"></script>
<script src="/static/client/mui/js/mui.min.js" charset="utf-8"></script>
<script src="/static/client/js/jquery-loadprompt.js" charset="utf-8"></script>
	<script>
		if (<?php echo $is_card; ?> == 1) {
			mui.toast("您已购买了本月月卡,无需再次购买", {
				duration: 3000
			});

			function go() {
				window.history.go(-1);
			}
			setTimeout(() => go(), 3000);
		}

		// 购买月卡
		function buyCard() {
			var data = {};
			jQuery.ajax({
				url: "<?php echo url('card/wxpay_card'); ?>",
				data: data,
				type: "POST",
				dataType: 'json',
				beforeSend: function() {
					jQuery.showLoading('提交订单中', function() {});
				},
				success: function(res) {
					console.log(res)
					if (res.code == 200) {
						jQuery.loadSuccess('订单提交成功', function() {
							console.log('订单提交成功返回信息：' + JSON.stringify(res.data));
							var data = res.data;
							wakeupPay(res.data);
						});
					} else {
						jQuery.loadError('订单提交失败', function() {
							mui.toast(res.message, {
								duration: 3000
							});
						});
					}
				},
				error: function(xhr) {
					// 只有请求不正常（状态码不为200）才会执行
					jQuery.loadError('订单提交失败', function() {
						mui.toast("错误码：" + xhr.status, {
							duration: 3000
						});
					});
				},
			});
		}

		function wakeupPay(data) {
			jQuery.showLoading('支付中', function() {});
			WeixinJSBridge.invoke(
				'getBrandWCPayRequest', data,
				function(res) {
					if (res.err_msg == "get_brand_wcpay_request:ok") {
						// 使用以上方式判断前端返回,微信团队郑重提示：
						//res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。
						jQuery.loadSuccess('支付成功', function() {
							console.log('支付成功：' + JSON.stringify(res));
						});
					} else {
						jQuery.loadError('支付失败', function() {
							console.log('支付失败：' + JSON.stringify(res));
							mui.toast("支付失败：" + res.err_msg, {
								duration: 3000
							});
						});
					}
					// setTimeout(function() {
					// 	jumpOrdersDetail();
					// }, 3000);
				});
		}
		if (typeof WeixinJSBridge == "undefined"){
		   if( document.addEventListener ){
		    document.addEventListener('WeixinJSBridgeReady', wakeupPay, false);
		   }else if (document.attachEvent){
		    document.attachEvent('WeixinJSBridgeReady', wakeupPay); 
		    document.attachEvent('onWeixinJSBridgeReady', wakeupPay);
		   }
		}else{
		   wakeupPay();
		}
		function jumpOrdersDetail() {
			location.replace("<?php echo url('user/my_card'); ?>");
		}
	</script>
</html>
